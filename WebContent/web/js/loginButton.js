(function(){var STK=(function(){var that={};var errorList=[];that.inc=function(ns,undepended){return true};that.register=function(ns,maker){var NSList=ns.split(".");var step=that;var k=null;while(k=NSList.shift()){if(NSList.length){if(step[k]===undefined){step[k]={}}step=step[k]}else{if(step[k]===undefined){try{step[k]=maker(that)}catch(exp){}}}}};that.regShort=function(sname,sfun){if(that[sname]!==undefined){throw"["+sname+"] : short : has been register"}that[sname]=sfun};that.IE=/msie/i.test(navigator.userAgent);that.E=function(id){if(typeof id==="string"){return document.getElementById(id)}else{return id}};that.C=function(tagName){var dom;tagName=tagName.toUpperCase();if(tagName=="TEXT"){dom=document.createTextNode("")}else{if(tagName=="BUFFER"){dom=document.createDocumentFragment()}else{dom=document.createElement(tagName)}}return dom};that.log=function(str){errorList.push("["+((new Date()).getTime()%100000)+"]: "+str)};that.getErrorLogInformationList=function(n){return errorList.splice(0,n||errorList.length)};return that})();$Import=STK.inc;STK.register("core.evt.addEvent",function($){return function(sNode,sEventType,oFunc){var oElement=$.E(sNode);if(oElement==null){return false}sEventType=sEventType||"click";if((typeof oFunc).toLowerCase()!="function"){return}if(oElement.attachEvent){oElement.attachEvent("on"+sEventType,oFunc)}else{if(oElement.addEventListener){oElement.addEventListener(sEventType,oFunc,false)}else{oElement["on"+sEventType]=oFunc}}return true}});STK.register("core.evt.removeEvent",function($){return function(el,evType,func,useCapture){var _el=$.E(el);if(_el==null){return false}if(typeof func!="function"){return false}if(_el.removeEventListener){_el.removeEventListener(evType,func,useCapture)}else{if(_el.detachEvent){_el.detachEvent("on"+evType,func)}else{_el["on"+evType]=null}}return true}});STK.register("core.util.browser",function($){var ua=navigator.userAgent.toLowerCase();var external=window.external||"";var core,m,extra,version,os;var numberify=function(s){var c=0;return parseFloat(s.replace(/\./g,function(){return(c++==1)?"":"."}))};try{if((/windows|win32/i).test(ua)){os="windows"}else{if((/macintosh/i).test(ua)){os="macintosh"}else{if((/rhino/i).test(ua)){os="rhino"}}}if((m=ua.match(/applewebkit\/([^\s]*)/))&&m[1]){core="webkit";version=numberify(m[1])}else{if((m=ua.match(/presto\/([\d.]*)/))&&m[1]){core="presto";version=numberify(m[1])}else{if(m=ua.match(/msie\s([^;]*)/)){core="trident";version=1;if((m=ua.match(/trident\/([\d.]*)/))&&m[1]){version=numberify(m[1])}}else{if(/gecko/.test(ua)){core="gecko";version=1;if((m=ua.match(/rv:([\d.]*)/))&&m[1]){version=numberify(m[1])}}}}}if(/world/.test(ua)){extra="world"}else{if(/360se/.test(ua)){extra="360"}else{if((/maxthon/.test(ua))||typeof external.max_version=="number"){extra="maxthon"}else{if(/tencenttraveler\s([\d.]*)/.test(ua)){extra="tt"}else{if(/se\s([\d.]*)/.test(ua)){extra="sogou"}}}}}}catch(e){}var IE11=ua.indexOf("trident/7.0")!=-1&&(ua.indexOf("rv 11.0")!=-1||ua.indexOf("rv:11.0")!=-1);var ret={OS:os,CORE:core,Version:version,EXTRA:(extra?extra:false),IE:/msie/.test(ua)||IE11,OPERA:/opera/.test(ua),MOZ:/gecko/.test(ua)&&!/(compatible|webkit)/.test(ua),IE5:/msie 5 /.test(ua),IE55:/msie 5.5/.test(ua),IE6:/msie 6/.test(ua),IE7:/msie 7/.test(ua),IE8:/msie 8/.test(ua),IE9:/msie 9/.test(ua),IE11:IE11,SAFARI:!/chrome\/([\d.]*)/.test(ua)&&/\/([\d.]*) safari/.test(ua),CHROME:/chrome\/([\d.]*)/.test(ua),IPAD:/\(ipad/i.test(ua),IPHONE:/\(iphone/i.test(ua),ITOUCH:/\(itouch/i.test(ua),MOBILE:/mobile/i.test(ua)};return ret});STK.register("core.evt.getEvent",function($){return function(){if($.IE){return window.event}else{if(window.event){return window.event}var o=arguments.callee.caller;var e;var n=0;while(o!=null&&n<40){e=o.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent||e.constructor==KeyboardEvent)){return e}n++;o=o.caller}return e}}});STK.register("core.evt.stopEvent",function($){return function(e){var ev=e?e:$.core.evt.getEvent();if($.IE){ev.cancelBubble=true;ev.returnValue=false}else{ev.preventDefault();ev.stopPropagation()}return false}});STK.register("core.util.listener",function($){return(function(){var dispatchList={};var topWindow;var fireTaskList=[];var fireTaskTimer;function runFireTaskList(){if(fireTaskList.length==0){return}clearTimeout(fireTaskTimer);var curFireTask=fireTaskList.splice(0,1)[0];try{curFireTask.func.apply(curFireTask.func,[].concat(curFireTask.data))}catch(exp){$.log("[error][listener]: One of "+curFireTask+"-"+curFireTask+" function execute error.")}fireTaskTimer=setTimeout(runFireTaskList,25)}var dispatch={conn:function(){var win=window;while(win!=top){win=win.parent;if(win.STK&&win.STK["core"]&&win.STK["core"]["util"]&&win.STK["core"]["util"]["listener"]!=null){topWindow=win}}},register:function(sChannel,sEventType,fCallBack){if(topWindow!=null){topWindow.STK["core"]["util"]["listener"].register(sChannel,sEventType,fCallBack)}else{dispatchList[sChannel]=dispatchList[sChannel]||{};dispatchList[sChannel][sEventType]=dispatchList[sChannel][sEventType]||[];dispatchList[sChannel][sEventType].push(fCallBack)}},fire:function(sChannel,sEventType,oData){if(topWindow!=null){topWindow.listener.fire(sChannel,sEventType,oData)}else{var funcArray;var i,len;if(dispatchList[sChannel]&&dispatchList[sChannel][sEventType]&&dispatchList[sChannel][sEventType].length>0){funcArray=dispatchList[sChannel][sEventType];funcArray.data_cache=oData;for(i=0,len=funcArray.length;i<len;i++){fireTaskList.push({channel:sChannel,evt:sEventType,func:funcArray[i],data:oData})}runFireTaskList()}}},remove:function(sChannel,sEventType,fCallBack){if(topWindow!=null){topWindow.STK["core"]["util"]["listener"].remove(sChannel,sEventType,fCallBack)}else{if(dispatchList[sChannel]){if(dispatchList[sChannel][sEventType]){for(var i=0,len=dispatchList[sChannel][sEventType].length;i<len;i++){if(dispatchList[sChannel][sEventType][i]===fCallBack){dispatchList[sChannel][sEventType].splice(i,1);break}}}}}},list:function(){return dispatchList},cache:function(sChannel,sEventType){if(topWindow!=null){return topWindow.listener.cache(sChannel,sEventType)}else{if(dispatchList[sChannel]&&dispatchList[sChannel][sEventType]){return dispatchList[sChannel][sEventType].data_cache}}}};return dispatch})()});STK.register("core.util.easyTemplate",function($){var easyTemplate=function(s,d){if(!s){return""}if(s!==easyTemplate.template){easyTemplate.template=s;easyTemplate.aStatement=easyTemplate.parsing(easyTemplate.separate(s))}var aST=easyTemplate.aStatement;var process=function(d2){if(d2){d=d2}return arguments.callee};process.toString=function(){return(new Function(aST[0],aST[1]))(d)};return process};easyTemplate.separate=function(s){var r=/\\'/g;var sRet=s.replace(/(<(\/?)#(.*?(?:\(.*?\))*)>)|(')|([\r\n\t])|(\$\{([^\}]*?)\})/g,function(a,b,c,d,e,f,g,h){if(b){return"{|}"+(c?"-":"+")+d+"{|}"}if(e){return"\\'"}if(f){return""}if(g){return"'+("+h.replace(r,"'")+")+'"}});return sRet};easyTemplate.parsing=function(s){var mName,vName,sTmp,aTmp,sFL,sEl,aList,aStm=["var aRet = [];"];aList=s.split(/\{\|\}/);var r=/\s/;while(aList.length){sTmp=aList.shift();if(!sTmp){continue}sFL=sTmp.charAt(0);if(sFL!=="+"&&sFL!=="-"){sTmp="'"+sTmp+"'";aStm.push("aRet.push("+sTmp+");");continue}aTmp=sTmp.split(r);switch(aTmp[0]){case"+et":mName=aTmp[1];vName=aTmp[2];aStm.push('aRet.push("<!--'+mName+' start-->");');break;case"-et":aStm.push('aRet.push("<!--'+mName+' end-->");');break;case"+if":aTmp.splice(0,1);aStm.push("if"+aTmp.join(" ")+"{");break;case"+elseif":aTmp.splice(0,1);aStm.push("}else if"+aTmp.join(" ")+"{");break;case"-if":aStm.push("}");break;case"+else":aStm.push("}else{");break;case"+list":aStm.push("if("+aTmp[1]+".constructor === Array){with({i:0,l:"+aTmp[1]+".length,"+aTmp[3]+"_index:0,"+aTmp[3]+":null}){for(i=l;i--;){"+aTmp[3]+"_index=(l-i-1);"+aTmp[3]+"="+aTmp[1]+"["+aTmp[3]+"_index];");break;case"-list":aStm.push("}}}");break;default:break}}aStm.push('return aRet.join("");');return[vName,aStm.join("")]};return easyTemplate});STK.register("common.tool",function($){var that={};var userCache={};var getUid=function(callback){WB2.parseCMD("/account/get_uid.json",function(sResult,bStatus){if(bStatus&&sResult.uid){callback(sResult.uid,bStatus)}else{callback(bStatus)}},{},{method:"get",cache_time:100})};var loadCurrentUser=function(uid,callback){callback=callback||function(){};if(userCache[uid]){callback(userCache[uid]);return}WB2.parseCMD("/users/show.json",function(sResult,bStatus){userCache[uid]=sResult;callback(sResult)},{uid:uid},{method:"get"})};var loadCurrentUserByName=function(nickname,callback){callback=callback||function(){};if(userCache[nickname]){callback(userCache[nickname]);return}WB2.parseCMD("/users/show.json",function(sResult,bStatus){userCache[nickname]=sResult;callback(sResult)},{screen_name:encodeURIComponent(nickname)},{method:"get",cache_time:100})};that.getUid=getUid;that.loadCurrentUser=loadCurrentUser;that.loadCurrentUserByName=loadCurrentUserByName;return that});STK.register("core.obj.parseParam",function($){return function(oSource,oParams,isown){var key,obj={};oParams=oParams||{};for(key in oSource){obj[key]=oSource[key];if(oParams[key]!=null){if(isown){if(oSource.hasOwnProperty[key]){obj[key]=oParams[key]}}else{obj[key]=oParams[key]}}}return obj}});STK.register("core.arr.indexOf",function($){return function(oElement,aSource){if(aSource.indexOf){return aSource.indexOf(oElement)}for(var i=0,len=aSource.length;i<len;i++){if(aSource[i]===oElement){return i}}return -1}});STK.register("core.arr.inArray",function($){return function(oElement,aSource){return $.core.arr.indexOf(oElement,aSource)>-1}});STK.register("core.func.getType",function($){return function(oObject){var _t;return((_t=typeof(oObject))=="object"?oObject==null&&"null"||Object.prototype.toString.call(oObject).slice(8,-1):_t).toLowerCase()}});STK.register("core.dom.sizzle",function($){var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,done=0,toString=Object.prototype.toString,hasDuplicate=false,baseHasDuplicate=true;[0,0].sort(function(){baseHasDuplicate=false;return 0});var Sizzle=function(selector,context,results,seed){results=results||[];context=context||document;var origContext=context;if(context.nodeType!==1&&context.nodeType!==9){return[]}if(!selector||typeof selector!=="string"){return results}var parts=[],m,set,checkSet,extra,prune=true,contextXML=Sizzle.isXML(context),soFar=selector,ret,cur,pop,i;do{chunker.exec("");m=chunker.exec(soFar);if(m){soFar=m[3];parts.push(m[1]);if(m[2]){extra=m[3];break}}}while(m);if(parts.length>1&&origPOS.exec(selector)){if(parts.length===2&&Expr.relative[parts[0]]){set=posProcess(parts[0]+parts[1],context)}else{set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);while(parts.length){selector=parts.shift();if(Expr.relative[selector]){selector+=parts.shift()}set=posProcess(selector,set)}}}else{if(!seed&&parts.length>1&&context.nodeType===9&&!contextXML&&Expr.match.ID.test(parts[0])&&!Expr.match.ID.test(parts[parts.length-1])){ret=Sizzle.find(parts.shift(),context,contextXML);context=ret.expr?Sizzle.filter(ret.expr,ret.set)[0]:ret.set[0]}if(context){ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),parts.length===1&&(parts[0]==="~"||parts[0]==="+")&&context.parentNode?context.parentNode:context,contextXML);set=ret.expr?Sizzle.filter(ret.expr,ret.set):ret.set;if(parts.length>0){checkSet=makeArray(set)}else{prune=false}while(parts.length){cur=parts.pop();pop=cur;if(!Expr.relative[cur]){cur=""}else{pop=parts.pop()}if(pop==null){pop=context}Expr.relative[cur](checkSet,pop,contextXML)}}else{checkSet=parts=[]}}if(!checkSet){checkSet=set}if(!checkSet){Sizzle.error(cur||selector)}if(toString.call(checkSet)==="[object Array]"){if(!prune){results.push.apply(results,checkSet)}else{if(context&&context.nodeType===1){for(i=0;checkSet[i]!=null;i++){if(checkSet[i]&&(checkSet[i]===true||checkSet[i].nodeType===1&&Sizzle.contains(context,checkSet[i]))){results.push(set[i])}}}else{for(i=0;checkSet[i]!=null;i++){if(checkSet[i]&&checkSet[i].nodeType===1){results.push(set[i])}}}}}else{makeArray(checkSet,results)}if(extra){Sizzle(extra,origContext,results,seed);Sizzle.uniqueSort(results)}return results};Sizzle.uniqueSort=function(results){if(sortOrder){hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(var i=1;i<results.length;i++){if(results[i]===results[i-1]){results.splice(i--,1)}}}}return results};Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set)};Sizzle.find=function(expr,context,isXML){var set;if(!expr){return[]}for(var i=0,l=Expr.order.length;i<l;i++){var type=Expr.order[i],match;if((match=Expr.leftMatch[type].exec(expr))){var left=match[1];match.splice(1,1);if(left.substr(left.length-1)!=="\\"){match[1]=(match[1]||"").replace(/\\/g,"");set=Expr.find[type](match,context,isXML);if(set!=null){expr=expr.replace(Expr.match[type],"");break}}}}if(!set){set=context.getElementsByTagName("*")}return{set:set,expr:expr}};Sizzle.filter=function(expr,set,inplace,not){var old=expr,result=[],curLoop=set,match,anyFound,isXMLFilter=set&&set[0]&&Sizzle.isXML(set[0]);while(expr&&set.length){for(var type in Expr.filter){if((match=Expr.leftMatch[type].exec(expr))!=null&&match[2]){var filter=Expr.filter[type],found,item,left=match[1];anyFound=false;match.splice(1,1);if(left.substr(left.length-1)==="\\"){continue}if(curLoop===result){result=[]}if(Expr.preFilter[type]){match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter);if(!match){anyFound=found=true}else{if(match===true){continue}}}if(match){for(var i=0;(item=curLoop[i])!=null;i++){if(item){found=filter(item,match,i,curLoop);var pass=not^!!found;if(inplace&&found!=null){if(pass){anyFound=true}else{curLoop[i]=false}}else{if(pass){result.push(item);anyFound=true}}}}}if(found!==undefined){if(!inplace){curLoop=result}expr=expr.replace(Expr.match[type],"");if(!anyFound){return[]}break}}}if(expr===old){if(anyFound==null){Sizzle.error(expr)}else{break}}old=expr}return curLoop};Sizzle.error=function(msg){throw"Syntax error, unrecognized expression: "+msg};var Expr={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+\-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(elem){return elem.getAttribute("href")}},relative:{"+":function(checkSet,part){var isPartStr=typeof part==="string",isTag=isPartStr&&!/\W/.test(part),isPartStrNotTag=isPartStr&&!isTag;if(isTag){part=part.toLowerCase()}for(var i=0,l=checkSet.length,elem;i<l;i++){if((elem=checkSet[i])){while((elem=elem.previousSibling)&&elem.nodeType!==1){}checkSet[i]=isPartStrNotTag||elem&&elem.nodeName.toLowerCase()===part?elem||false:elem===part}}if(isPartStrNotTag){Sizzle.filter(part,checkSet,true)}},">":function(checkSet,part){var isPartStr=typeof part==="string",elem,i=0,l=checkSet.length;if(isPartStr&&!/\W/.test(part)){part=part.toLowerCase();for(;i<l;i++){elem=checkSet[i];if(elem){var parent=elem.parentNode;checkSet[i]=parent.nodeName.toLowerCase()===part?parent:false}}}else{for(;i<l;i++){elem=checkSet[i];if(elem){checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part}}if(isPartStr){Sizzle.filter(part,checkSet,true)}}},"":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck,nodeCheck;if(typeof part==="string"&&!/\W/.test(part)){part=part.toLowerCase();nodeCheck=part;checkFn=dirNodeCheck}checkFn("parentNode",part,doneName,checkSet,nodeCheck,isXML)},"~":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck,nodeCheck;if(typeof part==="string"&&!/\W/.test(part)){part=part.toLowerCase();nodeCheck=part;checkFn=dirNodeCheck}checkFn("previousSibling",part,doneName,checkSet,nodeCheck,isXML)}},find:{ID:function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?[m]:[]}},NAME:function(match,context){if(typeof context.getElementsByName!=="undefined"){var ret=[],results=context.getElementsByName(match[1]);for(var i=0,l=results.length;i<l;i++){if(results[i].getAttribute("name")===match[1]){ret.push(results[i])}}return ret.length===0?null:ret}},TAG:function(match,context){return context.getElementsByTagName(match[1])}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){match=" "+match[1].replace(/\\/g,"")+" ";if(isXML){return match}for(var i=0,elem;(elem=curLoop[i])!=null;i++){if(elem){if(not^(elem.className&&(" "+elem.className+" ").replace(/[\t\n]/g," ").indexOf(match)>=0)){if(!inplace){result.push(elem)}}else{if(inplace){curLoop[i]=false}}}}return false},ID:function(match){return match[1].replace(/\\/g,"")},TAG:function(match,curLoop){return match[1].toLowerCase()},CHILD:function(match){if(match[1]==="nth"){var test=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(match[2]==="even"&&"2n"||match[2]==="odd"&&"2n+1"||!/\D/.test(match[2])&&"0n+"+match[2]||match[2]);match[2]=(test[1]+(test[2]||1))-0;match[3]=test[3]-0}match[0]=done++;return match},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1].replace(/\\/g,"");if(!isXML&&Expr.attrMap[name]){match[1]=Expr.attrMap[name]}if(match[2]==="~="){match[4]=" "+match[4]+" "}return match},PSEUDO:function(match,curLoop,inplace,result,not){if(match[1]==="not"){if((chunker.exec(match[3])||"").length>1||/^\w/.test(match[3])){match[3]=Sizzle(match[3],null,null,curLoop)}else{var ret=Sizzle.filter(match[3],curLoop,inplace,true^not);if(!inplace){result.push.apply(result,ret)}return false}}else{if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0])){return true}}return match},POS:function(match){match.unshift(true);return match}},filters:{enabled:function(elem){return elem.disabled===false&&elem.type!=="hidden"},disabled:function(elem){return elem.disabled===true},checked:function(elem){return elem.checked===true},selected:function(elem){elem.parentNode.selectedIndex;return elem.selected===true},parent:function(elem){return !!elem.firstChild},empty:function(elem){return !elem.firstChild},has:function(elem,i,match){return !!Sizzle(match[3],elem).length},header:function(elem){return(/h\d/i).test(elem.nodeName)},text:function(elem){return"text"===elem.type},radio:function(elem){return"radio"===elem.type},checkbox:function(elem){return"checkbox"===elem.type},file:function(elem){return"file"===elem.type},password:function(elem){return"password"===elem.type},submit:function(elem){return"submit"===elem.type},image:function(elem){return"image"===elem.type},reset:function(elem){return"reset"===elem.type},button:function(elem){return"button"===elem.type||elem.nodeName.toLowerCase()==="button"},input:function(elem){return(/input|select|textarea|button/i).test(elem.nodeName)}},setFilters:{first:function(elem,i){return i===0},last:function(elem,i,match,array){return i===array.length-1},even:function(elem,i){return i%2===0},odd:function(elem,i){return i%2===1},lt:function(elem,i,match){return i<match[3]-0},gt:function(elem,i,match){return i>match[3]-0},nth:function(elem,i,match){return match[3]-0===i},eq:function(elem,i,match){return match[3]-0===i}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter){return filter(elem,i,match,array)}else{if(name==="contains"){return(elem.textContent||elem.innerText||Sizzle.getText([elem])||"").indexOf(match[3])>=0}else{if(name==="not"){var not=match[3];for(var j=0,l=not.length;j<l;j++){if(not[j]===elem){return false}}return true}else{Sizzle.error("Syntax error, unrecognized expression: "+name)}}}},CHILD:function(elem,match){var type=match[1],node=elem;switch(type){case"only":case"first":while((node=node.previousSibling)){if(node.nodeType===1){return false}}if(type==="first"){return true}node=elem;case"last":while((node=node.nextSibling)){if(node.nodeType===1){return false}}return true;case"nth":var first=match[2],last=match[3];if(first===1&&last===0){return true}var doneName=match[0],parent=elem.parentNode;if(parent&&(parent.sizcache!==doneName||!elem.nodeIndex)){var count=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){node.nodeIndex=++count}}parent.sizcache=doneName}var diff=elem.nodeIndex-last;if(first===0){return diff===0}else{return(diff%first===0&&diff/first>=0)}}},ID:function(elem,match){return elem.nodeType===1&&elem.getAttribute("id")===match},TAG:function(elem,match){return(match==="*"&&elem.nodeType===1)||elem.nodeName.toLowerCase()===match},CLASS:function(elem,match){return(" "+(elem.className||elem.getAttribute("class"))+" ").indexOf(match)>-1},ATTR:function(elem,match){var name=match[1],result=Expr.attrHandle[name]?Expr.attrHandle[name](elem):elem[name]!=null?elem[name]:elem.getAttribute(name),value=result+"",type=match[2],check=match[4];return result==null?type==="!=":type==="="?value===check:type==="*="?value.indexOf(check)>=0:type==="~="?(" "+value+" ").indexOf(check)>=0:!check?value&&result!==false:type==="!="?value!==check:type==="^="?value.indexOf(check)===0:type==="$="?value.substr(value.length-check.length)===check:type==="|="?value===check||value.substr(0,check.length+1)===check+"-":false},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter){return filter(elem,i,match,array)}}}};Sizzle.selectors=Expr;var origPOS=Expr.match.POS,fescape=function(all,num){return"\\"+(num-0+1)};for(var type in Expr.match){Expr.match[type]=new RegExp(Expr.match[type].source+(/(?![^\[]*\])(?![^\(]*\))/.source));Expr.leftMatch[type]=new RegExp(/(^(?:.|\r|\n)*?)/.source+Expr.match[type].source.replace(/\\(\d+)/g,fescape))}var makeArray=function(array,results){array=Array.prototype.slice.call(array,0);if(results){results.push.apply(results,array);return results}return array};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(e){makeArray=function(array,results){var ret=results||[],i=0;if(toString.call(array)==="[object Array]"){Array.prototype.push.apply(ret,array)}else{if(typeof array.length==="number"){for(var l=array.length;i<l;i++){ret.push(array[i])}}else{for(;array[i];i++){ret.push(array[i])}}}return ret}}var sortOrder;if(document.documentElement.compareDocumentPosition){sortOrder=function(a,b){if(!a.compareDocumentPosition||!b.compareDocumentPosition){if(a==b){hasDuplicate=true}return a.compareDocumentPosition?-1:1}var ret=a.compareDocumentPosition(b)&4?-1:a===b?0:1;if(ret===0){hasDuplicate=true}return ret}}else{if("sourceIndex" in document.documentElement){sortOrder=function(a,b){if(!a.sourceIndex||!b.sourceIndex){if(a==b){hasDuplicate=true}return a.sourceIndex?-1:1}var ret=a.sourceIndex-b.sourceIndex;if(ret===0){hasDuplicate=true}return ret}}else{if(document.createRange){sortOrder=function(a,b){if(!a.ownerDocument||!b.ownerDocument){if(a==b){hasDuplicate=true}return a.ownerDocument?-1:1}var aRange=a.ownerDocument.createRange(),bRange=b.ownerDocument.createRange();aRange.setStart(a,0);aRange.setEnd(a,0);bRange.setStart(b,0);bRange.setEnd(b,0);var ret=aRange.compareBoundaryPoints(Range.START_TO_END,bRange);if(ret===0){hasDuplicate=true}return ret}}}}Sizzle.getText=function(elems){var ret="",elem;for(var i=0;elems[i];i++){elem=elems[i];if(elem.nodeType===3||elem.nodeType===4){ret+=elem.nodeValue}else{if(elem.nodeType!==8){ret+=Sizzle.getText(elem.childNodes)}}}return ret};(function(){var form=document.createElement("div"),id="script"+(new Date()).getTime();form.innerHTML="<a name='"+id+"'/>";var root=document.documentElement;root.insertBefore(form,root.firstChild);if(document.getElementById(id)){Expr.find.ID=function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id").nodeValue===match[1]?[m]:undefined:[]}};Expr.filter.ID=function(elem,match){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return elem.nodeType===1&&node&&node.nodeValue===match}}root.removeChild(form);root=form=null})();(function(){var div=document.createElement("div");div.appendChild(document.createComment(""));if(div.getElementsByTagName("*").length>0){Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if(match[1]==="*"){var tmp=[];for(var i=0;results[i];i++){if(results[i].nodeType===1){tmp.push(results[i])}}results=tmp}return results}}div.innerHTML="<a href='#'></a>";if(div.firstChild&&typeof div.firstChild.getAttribute!=="undefined"&&div.firstChild.getAttribute("href")!=="#"){Expr.attrHandle.href=function(elem){return elem.getAttribute("href",2)}}div=null})();if(document.querySelectorAll){(function(){var oldSizzle=Sizzle,div=document.createElement("div");div.innerHTML="<p class='TEST'></p>";if(div.querySelectorAll&&div.querySelectorAll(".TEST").length===0){return}Sizzle=function(query,context,extra,seed){context=context||document;if(!seed&&context.nodeType===9&&!Sizzle.isXML(context)){try{return makeArray(context.querySelectorAll(query),extra)}catch(e){}}return oldSizzle(query,context,extra,seed)};for(var prop in oldSizzle){Sizzle[prop]=oldSizzle[prop]}div=null})()}(function(){var div=document.createElement("div");div.innerHTML="<div class='test e'></div><div class='test'></div>";if(!div.getElementsByClassName||div.getElementsByClassName("e").length===0){return}div.lastChild.className="e";if(div.getElementsByClassName("e").length===1){return}Expr.order.splice(1,0,"CLASS");Expr.find.CLASS=function(match,context,isXML){if(typeof context.getElementsByClassName!=="undefined"&&!isXML){return context.getElementsByClassName(match[1])}};div=null})();function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){elem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break}if(elem.nodeType===1&&!isXML){elem.sizcache=doneName;elem.sizset=i}if(elem.nodeName.toLowerCase()===cur){match=elem;break}elem=elem[dir]}checkSet[i]=match}}}function dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){elem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break}if(elem.nodeType===1){if(!isXML){elem.sizcache=doneName;elem.sizset=i}if(typeof cur!=="string"){if(elem===cur){match=true;break}}else{if(Sizzle.filter(cur,[elem]).length>0){match=elem;break}}}elem=elem[dir]}checkSet[i]=match}}}Sizzle.contains=document.compareDocumentPosition?function(a,b){return !!(a.compareDocumentPosition(b)&16)}:function(a,b){return a!==b&&(a.contains?a.contains(b):true)};Sizzle.isXML=function(elem){var documentElement=(elem?elem.ownerDocument||elem:0).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};var posProcess=function(selector,context){var tmpSet=[],later="",match,root=context.nodeType?[context]:context;while((match=Expr.match.PSEUDO.exec(selector))){later+=match[0];selector=selector.replace(Expr.match.PSEUDO,"")}selector=Expr.relative[selector]?selector+"*":selector;for(var i=0,l=root.length;i<l;i++){Sizzle(selector,root[i],tmpSet)}return Sizzle.filter(later,tmpSet)};return Sizzle});STK.register("core.dom.builder",function($){function autoDeploy(sHTML,oSelector){if(oSelector){return oSelector}var result,re=/\<(\w+)[^>]*\s+node-type\s*=\s*([\'\"])?(\w+)\2.*?>/g;var selectorList={};var node,tag,selector;while((result=re.exec(sHTML))){tag=result[1];node=result[3];selector=tag+"[node-type="+node+"]";selectorList[node]=selectorList[node]==null?[]:selectorList[node];if(!$.core.arr.inArray(selector,selectorList[node])){selectorList[node].push(tag+"[node-type="+node+"]")}}return selectorList}return function(sHTML,oSelector){var _isHTML=$.core.func.getType(sHTML)=="string";var selectorList=autoDeploy(_isHTML?sHTML:sHTML.innerHTML,oSelector);var container=sHTML;if(_isHTML){container=$.C("div");container.innerHTML=sHTML}var key,domList,totalList;totalList=$.core.dom.sizzle("[node-type]",container);domList={};for(key in selectorList){domList[key]=$.core.dom.sizzle.matches(selectorList[key].toString(),totalList)}var domBox=sHTML;if(_isHTML){domBox=$.C("buffer");while(container.children[0]){domBox.appendChild(container.children[0])}}return{box:domBox,list:domList}}});STK.register("template.button.loginButton",function($){var that={btn1:'<a href="javascript:void(0);"><img src="http://timg.sjs.sinajs.cn/t4/appstyle/widget/images/loginButton/loginButton_48.png" /></a>',btn2:'<a href="javascript:void(0);"><img src="http://timg.sjs.sinajs.cn/t4/appstyle/widget/images/loginButton/loginButton_32.png" /></a>',btn3:'<a href="javascript:void(0);"><img src="http://timg.sjs.sinajs.cn/t4/appstyle/widget/images/loginButton/loginButton_24.png" /></a>',btn4:'<a href="javascript:void(0);"><img src="http://timg.sjs.sinajs.cn/t4/appstyle/widget/images/loginButton/loginButton_18.png" /></a>',btn5:'<img src="http://timg.sjs.sinajs.cn/t4/appstyle/widget/images/loginButton/loginButton_16a.png" /><a class="login_a" href="javascript:void(0);">微博登录</a>',btn6:'<img src="http://timg.sjs.sinajs.cn/t4/appstyle/widget/images/loginButton/loginButton_16b.png" /><a class="login_a" href="javascript:void(0);">微博登录</a>',btn7:'<a class="login_b WB_loginButton WB_widgets" href="javascript:void(0);">微博登录</a>',login1:'<#et temp data><div class="WB_loginButton WB_widgets"><div class="user_info clearfix"><div class="info_pic"><a href="${data.url}"><img src="${data.img}" alt="${data.name}" /></a></div><div class="info_detail"><a class="detail_name" ${data.styleStr}href="${data.url}" title="${data.name}">${data.shortname}</a><a class="loginout" href="javascript:void(0);" node-type="wb_loginButton_login">退出</a></div></div><ul class="user_atten ${data.classStr} clearfix "><li><a href="//weibo.com/${data.uid}/follow"><strong>${data.follow}</strong><span>关注</span></a></li><li><a href="//weibo.com/${data.uid}/fans"><strong>${data.fans}</strong><span>粉丝</span></a></li><li class="last"><a href="//weibo.com/${data.uid}/profile"><strong>${data.weibo}</strong><span>微博</span></a></li></ul></div></#et>',login2:'<#et temp data><div class="WB_loginButton WB_widgets login_button_32"><a href="${data.url}"><img src="${data.img}" alt="${data.name}" /></a><a class="login_a" href="${data.url}" title="${data.name}">${data.shortname}</a><a class="login_a loginout" href="javascript:void(0);" node-type="wb_loginButton_login">退出</a></div></#et>',login3:'<#et temp data><div class="WB_loginButton WB_widgets"><img src="http://timg.sjs.sinajs.cn/t4/appstyle/widget/images/loginButton/loginButton_16a.png" alt="${data.name}" /><a class="login_a" href="${data.url}">${data.shortname}</a><a class="login_a loginout" href="javascript:void(0);" node-type="wb_loginButton_login">退出</a></div></#et>',login4:'<#et temp data><div class="WB_loginButton WB_widgets"><img src="http://timg.sjs.sinajs.cn/t4/appstyle/widget/images/loginButton/loginButton_16b.png" alt="${data.name}" /><a class="login_a" href="${data.url}" title="${data.name}">${data.shortname}</a><a class="login_a loginout" href="javascript:void(0);" node-type="wb_loginButton_login">退出</a></div></#et>',login5:'<#et temp data><div class="WB_loginButton WB_widgets"><a class="login_b" href="${data.url}" title="${data.name}">${data.shortname}</a><a class="login_a loginout" href="javascript:void(0);" node-type="wb_loginButton_login">退出</a></div></#et>'};return that});STK.register("comp.button.loginButton",function($){var loadCurrentUser=function(callback){var getUserInfo=function(uid){callback=callback||function(){};if(currentUser){callback(currentUser);return}WB2.parseCMD("/users/show.json",function(sResult,bStatus){if(!bStatus){callback(false);return}if(sResult&&(sResult.error_code=="400"||sResult.error_code=="403")){callback(false);return}currentUser=sResult;try{callback(sResult)}catch(e){}},{uid:uid},{method:"get"})};STK.common.tool.getUid(getUserInfo)};return{loadCurrentUser:loadCurrentUser}});STK.register("kit.extra.merge",function($){return function(a,b){var buf={};for(var k in a){buf[k]=a[k]}for(var k in b){buf[k]=b[k]}return buf}});STK.register("common.social.statistical",function($){var STATIC_URL="http://rs.sinajs.cn/tmp.gif?";return function(opts){var that={};var conf=$.kit.extra.merge({id:"hotlist",refer:document.location.hostname},opts);that.request=function(args){args=$.kit.extra.merge(args,conf);var params="";for(var k in args){params+=(k+"="+encodeURIComponent(args[k])+"&")}params+="r="+(new Date()).valueOf();var IMG=new Image();IMG.src=STATIC_URL+params};return that}});var sCore=STK.core,addEvent=sCore.evt.addEvent,removeEvent=sCore.evt.removeEvent,listener=sCore.util.listener,easyTemplate=sCore.util.easyTemplate,parseParam=sCore.obj.parseParam,builder=sCore.dom.builder,loginFun=WB2.login,logoutFun=WB2.logout,currentUser=null,E=STK.E,C=STK.C,template=STK.template.button.loginButton,loadCurrentUser=STK.comp.button.loginButton.loadCurrentUser;var statistical=STK.common.social.statistical({id:"widget_loginbutton"});if(!WB2.listener){WB2.listener=listener}var getSmallImage=function(url){return url.replace(/\/50\//,"/30/")};var byteLen=function(s){return s.toString().replace(/[^\x00-\xff]/g,"--").length};var subByte=function(s,len,tail){if(byteLen(s)<=len){return s}tail=tail||"";len-=byteLen(tail);return s.replace(/([^\x00-\xff])/g,"$1 ").substr(0,len).replace(/[^\x00-\xff]$/,"").replace(/([^\x00-\xff]) /g,"$1")+tail};var loginButton=function(opts){var defaultOpt={dom:null,id:"wb_connect_btn",callback:{},type:"3,2",btn_style:3,btn_template:"",login_style:2,login_template:"",onlogin:null,onlogout:null};opts=parseParam(defaultOpt,opts);var style=opts.type.split(",");if(style.length!=2){throw"error parameters in type"}opts.btn_style=style[0];opts.login_style=style[1];statistical.request({action:"pv",url:encodeURIComponent(document.location.href)});if(opts.onlogin){try{var login_cbk=eval(opts.onlogin);if(login_cbk&&typeof login_cbk==="function"){opts.callback.login=login_cbk}}catch(e){}}if(opts.onlogout){try{var logout_cbk=eval(opts.onlogout);if(logout_cbk&&typeof logout_cbk==="function"){opts.callback.logout=logout_cbk}}catch(e){}}"btn login".replace(/[^ ]+/g,function(a){if(opts[a+"_template"]===""){opts[a+"_template"]=template[a+opts[a+"_style"]]}});var oBtn=E(opts.dom)||E(opts.id),oCallBack=opts.callback;var _is_connect=function(doFire){loadCurrentUser(function(json){if(json===false){_no_connect();return}var data={json:json};typeof oCallBack.login==="function"&&oCallBack.login(json);doFire?WB2.listener.fire("loginButton","listenerLogin",data):listenerLogin(data)})},_no_connect=function(){WB2.listener.fire("loginButton","listenerLogout")};var oBtnClick=function(){loginFun(function(){_is_connect(1)});STK.core.evt.stopEvent()};var loginBtn=function(){oBtn.innerHTML="";var btn=C("div");btn.className="WB_loginButton WB_widgets";btn.innerHTML=opts.btn_template;oBtn.appendChild(btn)};var listenerLogin=function(data,once){if(!data&&!once){loadCurrentUser(function(json){if(json===false){_no_connect();return}typeof oCallBack.login==="function"&&oCallBack.login(json);listenerLogin({json:json},1)});return}data=data.json;var config={name:data.screen_name,url:"//weibo.com/u/"+data.id,uid:data.id,weibo:data.statuses_count,fans:data.followers_count,styleStr:"",classStr:"",follow:data.friends_count};config.img=data.profile_image_url;var styleNum=parseInt(opts.login_style,10);if(styleNum===1){config.shortname=subByte(config.name,22,"...");if(byteLen(config.name)<=14){config.styleStr='style="display:block;"'}}else{config.img=getSmallImage(config.img);config.shortname=subByte(config.name,16,"...")}var alllen=byteLen(config.fans)+byteLen(config.weibo)+byteLen(config.follow);if(alllen>=17){config.classStr=alllen<19?" user_atten_s ":" user_atten_l "}config.shortname=data.screen_name;var temp=easyTemplate(opts.login_template,config).toString();removeEvent(oBtn,"click",oBtnClick);oBtn.innerHTML=temp;var logoutLinks=sCore.dom.sizzle('[node-type="wb_loginButton_login"]',oBtn);if(logoutLinks.length>0){for(var i=0,len=logoutLinks.length;i<len;i++){addEvent(logoutLinks[i],"click",function(){logoutFun(function(){_no_connect();typeof oCallBack.logout==="function"&&oCallBack.logout()});currentUser=null;STK.core.evt.stopEvent();return false})}}},listenerLogout=function(){loginBtn();addEvent(oBtn,"click",oBtnClick)};loginBtn();WB2.listener.register("loginButton","listenerLogin",listenerLogin);WB2.listener.register("loginButton","listenerLogout",listenerLogout);if(WB2.checkLogin()){_is_connect(0)}else{listenerLogout()}};WB2.widget.loginButton=loginButton})();